<%- include('_header') %>
    <h2>Create a room</h2>
    <form id="create-room">
        <input type="text" id="room-name" class="form-control" placeholder="Name">
        <select id="room-type" class="form-control">
            <option value="" selected disabled>Type</option>
            <option value="public">Public</option>
            <option value="private">Private</option>
        </select>
        <textarea id="room-description" class="form-control" placeholder="Description" cols="20" rows="5"></textarea>
        <input type="text" id="room-tags" class="form-control" placeholder="Tags">
        <button type="submit" class="btn btn-primary">Create</button>
    </form>
    <h1>Your Rooms</h1>
    <div id="user-rooms" class="flex-container rooms">

    </div>
    <h1>Public Rooms</h1>
    <form id="search-form">
        <div class="mb-3 mx-auto">
            <label for="q" class="form-label">Search Public Rooms</label>
            <input type="text" class="form-control" id="search-public-rooms">
        </div>
    </form>
    <div id="public-rooms" class="flex-container rooms">
    </div>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="http://127.0.0.1:3000/searchPublicRooms.js"></script>
    <script>


        document.querySelector('#create-room').addEventListener('submit', e => {
            e.preventDefault()
            let name = document.querySelector('#room-name')
            let type = document.querySelector('#room-type')
            let description = document.querySelector('#room-description')
            let tags = document.querySelector('#room-tags')
            axios.post('http://127.0.0.1:3000/api/rooms', {
                name: name.value,
                type: type.value,
                description: description.value,
                tags: tags.value.split(',')
            })
                .then(res => {
                    alert(res.data)
                    searchPublicRooms('')
                })
                .catch(err => {
                    console.log(err.response)
                    if (err.response.status == 409)
                        alert('Room name already taken.')
                })
        })

        // Get and display user rooms
        axios.get('http://127.0.0.1:3000/api/user-rooms', { withCredentials: true })
            .then(res => {
                document.querySelector('#user-rooms').innerHTML = displayRooms(res.data.rooms)
            })

        // Get and display public rooms
        axios.get('http://127.0.0.1:3000/api/rooms', { withCredentials: true })
            .then(res => {
                document.querySelector('#public-rooms').innerHTML = displayRooms(res.data.rooms)
            })


        function displayRooms(rooms) {
            let html = ''
            rooms.forEach(room => {

                html += `<div class="card text-center m-1" style="display: inline-block;">
                <h5 class="card-header">
                    ${room.name}
                </h5>
                <div class="card-body">
                    <p class="card-text">
                        ${room.description}
                        <br>
                            Room type: ${room.type}
                    </p>
                        <div>
                            ${displayTags(room.tags)}
                        </div>
                        <a href="/rooms/${room.name}" class="btn btn-primary mt-2">Join Room</a>
                </div>
                </div>`
            })
            return html
        }

        function displayTags(tags) {
            let html = ''
            tags.forEach(tag => {
                html += `<span class="badge rounded-pill bg-primary">${tag}</span>`
            })
            return html
        }


    </script>

    <%- include('_footer') %>